file(GLOB C_FILES RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} ${CMAKE_CURRENT_SOURCE_DIR}/*.c)
add_custom_target(@name-tests)

# Dependencies
@for(dependencies)
if (NOT TARGET @key)
    if (EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/lib/@key/CMakeLists.txt")
        add_subdirectory(lib/@key)
        link_libraries(@key)
        include_directories(../lib/@key/include ../lib/@key/header)
    else ()
        include_directories(../lib/@key/include ../lib/@key)
    endif()
endif ()
@end
include_directories(../header)

foreach (module ${C_FILES})
    get_filename_component(name ${module} NAME_WE)
    set(libname @name-ts-${name})
    add_library(${libname} SHARED ${module})
    target_link_libraries(${libname} PRIVATE @name)
    add_dependencies(@name-tests ${libname})
endforeach ()
